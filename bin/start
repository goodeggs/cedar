#!/bin/bash
set -o errexit    # always exit on error
set -o pipefail   # don't ignore exit codes when piping output
set -o nounset    # fail on unset variables

# correct memory measurement for docker containers
# used to set WEB_CONCURRENCY in the nodejs buildpack
if [ -f /sys/fs/cgroup/memory/memory.limit_in_bytes ]; then
  bytes=$(cat /sys/fs/cgroup/memory/memory.limit_in_bytes)
  export MEMORY_AVAILABLE=$(( $bytes / 1000000 ))
fi

for FILE in $(find /app/.profile.d/ -name '*.sh'); do
  source $FILE
done

# set a default DYNO
export DYNO="${PROCESS:-run}.$(hostname)"

eval exec $@
